<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OrganizaCode</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&amp;family=Outfit:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body { height: 100%; width: 100%; }

    :root {
      --bg-color: #0a0e1a;
      --surface-color: #131829;
      --text-color: #e2e8f0;
      --primary-color: #6366f1;
      --secondary-color: #22d3ee;
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
    }

    .font-mono { font-family: 'JetBrains Mono', monospace; }

    .app-wrapper {
      width: 100%;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      background: var(--bg-color);
    }

    /* Grid background pattern */
    .grid-bg {
      background-image:
        linear-gradient(rgba(99,102,241,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99,102,241,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Glow effects */
    .glow-primary {
      box-shadow: 0 0 30px rgba(99,102,241,0.15), 0 0 60px rgba(99,102,241,0.05);
    }

    .glow-cyan {
      box-shadow: 0 0 20px rgba(34,211,238,0.15);
    }

    /* Animations */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(24px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes pulseGlow {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 1; }
    }

    @keyframes typewriter {
      from { width: 0; }
      to { width: 100%; }
    }

    .animate-fade-up {
      animation: fadeInUp 0.6s ease-out both;
    }

    .animate-slide-left {
      animation: slideInLeft 0.5s ease-out both;
    }

    .animate-slide-right {
      animation: slideInRight 0.5s ease-out both;
    }

    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }
    .stagger-5 { animation-delay: 0.5s; }

    /* Scrollbar */
    .app-wrapper::-webkit-scrollbar { width: 6px; }
    .app-wrapper::-webkit-scrollbar-track { background: var(--bg-color); }
    .app-wrapper::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 3px; }

    /* Code block styling */
    .code-block {
      background: #0d1117;
      border: 1px solid rgba(99,102,241,0.15);
      border-radius: 8px;
      overflow: hidden;
    }

    .code-block pre {
      padding: 16px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.6;
      color: #c9d1d9;
    }

    .code-block pre::-webkit-scrollbar { height: 4px; }
    .code-block pre::-webkit-scrollbar-thumb { background: rgba(99,102,241,0.3); border-radius: 2px; }

    .code-header {
      background: rgba(99,102,241,0.08);
      border-bottom: 1px solid rgba(99,102,241,0.15);
      padding: 8px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* Language sidebar items */
    .lang-item {
      transition: all 0.2s ease;
      cursor: pointer;
      border-left: 3px solid transparent;
    }

    .lang-item:hover {
      background: rgba(99,102,241,0.08);
      border-left-color: var(--secondary-color);
    }

    .lang-item.active {
      background: rgba(99,102,241,0.12);
      border-left-color: var(--primary-color);
    }

    /* Category chips */
    .cat-chip {
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .cat-chip:hover {
      background: rgba(99,102,241,0.2);
      transform: translateY(-1px);
    }

    .cat-chip.active {
      background: var(--primary-color);
      color: white;
    }

    /* Snippet card */
    .snippet-card {
      background: var(--surface-color);
      border: 1px solid rgba(99,102,241,0.1);
      border-radius: 12px;
      transition: all 0.25s ease;
      cursor: pointer;
    }

    .snippet-card:hover {
      border-color: rgba(99,102,241,0.3);
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: var(--surface-color);
      border: 1px solid rgba(99,102,241,0.2);
      border-radius: 16px;
      width: 100%;
      max-width: 640px;
      max-height: 85%;
      overflow-y: auto;
      animation: fadeInUp 0.3s ease-out;
    }

    /* Input styles */
    .input-field {
      background: rgba(10,14,26,0.8);
      border: 1px solid rgba(99,102,241,0.15);
      border-radius: 8px;
      padding: 10px 14px;
      color: var(--text-color);
      font-family: 'Outfit', sans-serif;
      font-size: 14px;
      transition: border-color 0.2s ease;
      width: 100%;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
    }

    .input-field::placeholder { color: rgba(226,232,240,0.3); }

    textarea.input-field {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      resize: vertical;
      min-height: 120px;
    }

    /* Buttons */
    .btn-primary {
      background: var(--primary-color);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-family: 'Outfit', sans-serif;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-primary:hover {
      filter: brightness(1.15);
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-color);
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid rgba(99,102,241,0.2);
      font-family: 'Outfit', sans-serif;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-ghost:hover {
      background: rgba(99,102,241,0.08);
    }

    .btn-danger {
      background: rgba(239,68,68,0.15);
      color: #f87171;
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid rgba(239,68,68,0.2);
      font-family: 'Outfit', sans-serif;
      font-weight: 500;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-danger:hover {
      background: rgba(239,68,68,0.25);
    }

    /* Copy button */
    .copy-btn {
      background: rgba(34,211,238,0.1);
      border: 1px solid rgba(34,211,238,0.2);
      color: var(--secondary-color);
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-family: 'Outfit', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .copy-btn:hover {
      background: rgba(34,211,238,0.2);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--surface-color);
      border: 1px solid rgba(99,102,241,0.3);
      border-radius: 10px;
      padding: 12px 20px;
      z-index: 200;
      animation: fadeInUp 0.3s ease-out;
      font-size: 14px;
    }

    /* Confirm inline */
    .confirm-inline {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      animation: fadeInUp 0.2s ease-out;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: rgba(226,232,240,0.3);
    }

    /* Search bar */
    .search-bar {
      background: rgba(19,24,41,0.8);
      border: 1px solid rgba(99,102,241,0.15);
      border-radius: 10px;
      padding: 8px 14px;
      color: var(--text-color);
      font-family: 'Outfit', sans-serif;
      font-size: 14px;
      transition: all 0.2s ease;
      width: 260px;
    }

    .search-bar:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
      width: 320px;
    }

    .search-bar::placeholder { color: rgba(226,232,240,0.3); }

    /* FAB */
    .fab {
      position: fixed;
      bottom: 28px;
      right: 28px;
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: var(--primary-color);
      color: white;
      border: none;
      font-size: 28px;
      cursor: pointer;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      box-shadow: 0 4px 20px rgba(99,102,241,0.4);
    }

    .fab:hover {
      transform: scale(1.08) translateY(-2px);
      box-shadow: 0 6px 30px rgba(99,102,241,0.5);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .search-bar { width: 160px; }
      .search-bar:focus { width: 200px; }
      .main-layout { flex-direction: column !important; }
      .sidebar-panel { width: 100% !important; border-right: none !important; border-bottom: 1px solid rgba(99,102,241,0.1); }
    }

    /* Tag display */
    .tag-pill {
      display: inline-block;
      background: rgba(99,102,241,0.1);
      color: rgba(226,232,240,0.7);
      padding: 2px 10px;
      border-radius: 20px;
      font-size: 11px;
      margin: 2px;
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="app-wrapper grid-bg" id="appWrapper"><!-- Header -->
   <header class="w-full" style="background: rgba(19,24,41,0.85); border-bottom: 1px solid rgba(99,102,241,0.1); backdrop-filter: blur(12px); position: sticky; top: 0; z-index: 40;">
    <div style="max-width: 1400px; margin: 0 auto; padding: 14px 24px; display: flex; align-items: center; justify-content: space-between;">
     <div style="display: flex; align-items: center; gap: 10px;" class="animate-fade-up"><!-- Logo SVG -->
      <svg width="32" height="32" viewbox="0 0 32 32" fill="none"><rect width="32" height="32" rx="8" fill="url(#logoGrad)" /> <path d="M10 11L14 16L10 21" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" /> <path d="M16 21H22" stroke="#22d3ee" stroke-width="2.5" stroke-linecap="round" /> <defs>
        <lineargradient id="logoGrad" x1="0" y1="0" x2="32" y2="32">
         <stop stop-color="#6366f1" />
         <stop offset="1" stop-color="#8b5cf6" />
        </lineargradient>
       </defs>
      </svg><span id="appTitle" style="font-weight: 700; font-size: 20px; background: linear-gradient(135deg, #6366f1, #22d3ee); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">OrganizaCode</span>
     </div>
     <div style="display: flex; align-items: center; gap: 12px;" class="animate-fade-up stagger-2">
      <div style="position: relative;">
       <svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.4;" width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8" /><path d="m21 21-4.35-4.35" />
       </svg><input type="text" id="searchInput" class="search-bar" placeholder="Pesquisar snippets..." style="padding-left: 36px;" aria-label="Pesquisar snippets">
      </div>
     </div>
    </div>
   </header><!-- Hero Section -->
   <section id="heroSection" style="text-align: center; padding: 50px 24px 30px;">
    <div class="animate-fade-up stagger-1">
     <div style="display: inline-flex; align-items: center; gap: 6px; background: rgba(99,102,241,0.1); border: 1px solid rgba(99,102,241,0.2); border-radius: 20px; padding: 4px 14px; font-size: 12px; color: rgba(226,232,240,0.6); margin-bottom: 16px;">
      <svg width="14" height="14" viewbox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2">
       <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
      </svg> Seu organizador de c√≥digo pessoal
     </div>
    </div>
    <h1 id="heroTitle" class="animate-fade-up stagger-2" style="font-size: clamp(28px, 5vw, 44px); font-weight: 800; margin-bottom: 12px; line-height: 1.15;">Feito para salvar seu <span style="background: linear-gradient(135deg, #6366f1, #22d3ee); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">tempo.</span></h1>
    <p id="heroSubtitle" class="animate-fade-up stagger-3" style="font-size: 16px; color: rgba(226,232,240,0.5); max-width: 420px; margin: 0 auto 20px;">S√≥ copie, cole e pronto! Organize seus trechos de c√≥digo por linguagem e categoria.</p>
    <div class="animate-fade-up stagger-4" style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;"><span id="totalCount" style="background: rgba(99,102,241,0.1); border: 1px solid rgba(99,102,241,0.15); border-radius: 8px; padding: 6px 14px; font-size: 13px; color: rgba(226,232,240,0.6);"> <span style="color: #6366f1; font-weight: 700;">0</span> snippets salvos </span> <span id="langCount" style="background: rgba(34,211,238,0.08); border: 1px solid rgba(34,211,238,0.15); border-radius: 8px; padding: 6px 14px; font-size: 13px; color: rgba(226,232,240,0.6);"> <span style="color: #22d3ee; font-weight: 700;">0</span> linguagens </span>
    </div>
   </section><!-- Main Content -->
   <main style="max-width: 1400px; margin: 0 auto; padding: 0 24px 100px;" role="main">
    <div class="main-layout" style="display: flex; gap: 0; border: 1px solid rgba(99,102,241,0.1); border-radius: 16px; overflow: hidden; background: var(--surface-color); min-height: 500px;"><!-- Sidebar: Languages -->
     <nav class="sidebar-panel" style="width: 240px; border-right: 1px solid rgba(99,102,241,0.1); flex-shrink: 0;" aria-label="Linguagens">
      <div style="padding: 16px 18px 10px; font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: rgba(226,232,240,0.3); font-weight: 600;">
       Linguagens
      </div>
      <div id="langList" style="padding-bottom: 12px;"><!-- Languages rendered here -->
      </div>
     </nav><!-- Content Area -->
     <div style="flex: 1; display: flex; flex-direction: column; min-width: 0;"><!-- Categories bar -->
      <div style="padding: 14px 20px; border-bottom: 1px solid rgba(99,102,241,0.08); display: flex; align-items: center; gap: 8px; flex-wrap: wrap;"><span style="font-size: 12px; color: rgba(226,232,240,0.3); margin-right: 4px;">Categorias:</span>
       <div id="catList" style="display: flex; gap: 6px; flex-wrap: wrap;"><!-- Categories rendered here -->
       </div>
      </div><!-- Snippet list -->
      <div id="snippetArea" style="flex: 1; padding: 20px; overflow-y: auto;">
       <div class="empty-state" id="emptyState">
        <svg width="48" height="48" viewbox="0 0 24 24" fill="none" stroke="rgba(99,102,241,0.25)" stroke-width="1.5" style="margin: 0 auto 16px; display: block;"><path d="M16 18L22 12L16 6" /><path d="M8 6L2 12L8 18" />
        </svg>
        <p style="font-size: 16px; color: rgba(226,232,240,0.3); margin-bottom: 6px;">Nenhum snippet ainda</p>
        <p style="font-size: 13px; color: rgba(226,232,240,0.2);">Clique no <strong>+</strong> para adicionar seu primeiro trecho de c√≥digo</p>
       </div>
       <div id="snippetList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 14px;"><!-- Snippets rendered here -->
       </div>
      </div>
     </div>
    </div>
   </main><!-- Footer -->
   <footer style="text-align: center; padding: 24px; border-top: 1px solid rgba(99,102,241,0.08);">
    <p id="footerText" style="font-size: 13px; color: rgba(226,232,240,0.25);">Desenvolvido por <span style="color: #6366f1; font-weight: 600;">Amanda Reis</span></p>
   </footer><!-- FAB (Add button) --> <button class="fab" id="fabAdd" aria-label="Adicionar snippet">+</button> <!-- Add Modal -->
   <div class="modal-overlay" id="addModal" style="display: none;" role="dialog" aria-modal="true" aria-label="Adicionar snippet">
    <div class="modal-content">
     <div style="padding: 24px 24px 0;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
       <h2 style="font-size: 20px; font-weight: 700;">Novo Snippet</h2><button onclick="closeAddModal()" style="background: none; border: none; color: rgba(226,232,240,0.4); cursor: pointer; font-size: 24px; line-height: 1;" aria-label="Fechar">√ó</button>
      </div>
      <form id="addForm" style="display: flex; flex-direction: column; gap: 14px;">
       <div><label for="inputTitulo" style="font-size: 12px; color: rgba(226,232,240,0.5); margin-bottom: 4px; display: block;">T√≠tulo</label> <input type="text" id="inputTitulo" class="input-field" placeholder="ex: Filtrar array por valor" required>
       </div>
       <div style="display: flex; gap: 12px;">
        <div style="flex: 1;"><label for="inputLinguagem" style="font-size: 12px; color: rgba(226,232,240,0.5); margin-bottom: 4px; display: block;">Linguagem</label> <input type="text" id="inputLinguagem" class="input-field" placeholder="ex: JavaScript" required>
        </div>
        <div style="flex: 1;"><label for="inputCategoria" style="font-size: 12px; color: rgba(226,232,240,0.5); margin-bottom: 4px; display: block;">Categoria</label> <input type="text" id="inputCategoria" class="input-field" placeholder="ex: Arrays" required>
        </div>
       </div>
       <div><label for="inputCodigo" style="font-size: 12px; color: rgba(226,232,240,0.5); margin-bottom: 4px; display: block;">C√≥digo</label> <textarea id="inputCodigo" class="input-field" placeholder="Cole seu trecho de c√≥digo aqui..." required></textarea>
       </div>
       <div style="display: flex; gap: 10px; justify-content: flex-end; padding: 16px 0;"><button type="button" class="btn-ghost" onclick="closeAddModal()">Cancelar</button> <button type="submit" class="btn-primary"> <span style="display: flex; align-items: center; gap: 6px;">
          <svg width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
           <path d="M12 5v14M5 12h14" />
          </svg> Salvar </span> </button>
       </div>
      </form>
     </div>
    </div>
   </div><!-- View Modal -->
   <div class="modal-overlay" id="viewModal" style="display: none;" role="dialog" aria-modal="true" aria-label="Visualizar snippet">
    <div class="modal-content" style="max-width: 720px;">
     <div style="padding: 24px;" id="viewContent"><!-- Snippet detail rendered here -->
     </div>
    </div>
   </div><!-- Toast container -->
   <div id="toastContainer"></div>
  </div>
  <script>
    // ===== Backend (inline version of backend.js) =====
    let snippets = JSON.parse(localStorage.getItem("snippets")) || [];

    const salvar = () => localStorage.setItem("snippets", JSON.stringify(snippets));

    const adicionarSnippet = (titulo, linguagem, categoria, codigo) => {
      snippets.push({ id: Date.now(), titulo, linguagem, categoria, codigo });
      salvar();
    };

    const removerSnippet = (id) => {
      snippets = snippets.filter(s => s.id !== id);
      salvar();
    };

    const buscarSnippets = (termo) =>
      snippets.filter(s =>
        s.titulo.toLowerCase().includes(termo.toLowerCase()) ||
        s.codigo.toLowerCase().includes(termo.toLowerCase()) ||
        s.linguagem.toLowerCase().includes(termo.toLowerCase()) ||
        s.categoria.toLowerCase().includes(termo.toLowerCase())
      );

    // ===== State =====
    let selectedLang = null;
    let selectedCat = null;
    let searchTerm = "";

    // Language icons (SVG inline for common languages)
    const langIcons = {
      javascript: `<svg width="18" height="18" viewBox="0 0 24 24" fill="#f7df1e"><rect width="24" height="24" rx="3" fill="#f7df1e"/><text x="6" y="18" font-size="14" font-weight="bold" fill="#323330" font-family="monospace">JS</text></svg>`,
      python: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#3776ab"/><text x="4" y="17" font-size="12" font-weight="bold" fill="white" font-family="monospace">PY</text></svg>`,
      html: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#e34f26"/><text x="1" y="17" font-size="10" font-weight="bold" fill="white" font-family="monospace">HTML</text></svg>`,
      css: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#1572b6"/><text x="2" y="17" font-size="11" font-weight="bold" fill="white" font-family="monospace">CSS</text></svg>`,
      typescript: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#3178c6"/><text x="6" y="18" font-size="14" font-weight="bold" fill="white" font-family="monospace">TS</text></svg>`,
      java: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#ed8b00"/><text x="2" y="17" font-size="10" font-weight="bold" fill="white" font-family="monospace">JAVA</text></svg>`,
      php: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#777bb4"/><text x="2" y="17" font-size="11" font-weight="bold" fill="white" font-family="monospace">PHP</text></svg>`,
      csharp: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#68217a"/><text x="5" y="17" font-size="12" font-weight="bold" fill="white" font-family="monospace">C#</text></svg>`,
      ruby: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#cc342d"/><text x="4" y="17" font-size="12" font-weight="bold" fill="white" font-family="monospace">RB</text></svg>`,
      go: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#00add8"/><text x="4" y="17" font-size="12" font-weight="bold" fill="white" font-family="monospace">GO</text></svg>`,
      sql: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#336791"/><text x="2" y="17" font-size="11" font-weight="bold" fill="white" font-family="monospace">SQL</text></svg>`,
      rust: `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="#dea584"/><text x="4" y="17" font-size="12" font-weight="bold" fill="#323330" font-family="monospace">RS</text></svg>`,
    };

    function getLangIcon(lang) {
      const key = lang.toLowerCase().replace(/[^a-z]/g, '');
      if (langIcons[key]) return langIcons[key];
      // Fallback generic icon
      const color = stringToColor(lang);
      const initials = lang.substring(0, 2).toUpperCase();
      return `<svg width="18" height="18" viewBox="0 0 24 24"><rect width="24" height="24" rx="3" fill="${color}"/><text x="${initials.length > 1 ? 4 : 7}" y="17" font-size="12" font-weight="bold" fill="white" font-family="monospace">${initials}</text></svg>`;
    }

    function stringToColor(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
      const h = Math.abs(hash) % 360;
      return `hsl(${h}, 60%, 45%)`;
    }

    // ===== Rendering =====
    function getLanguages() {
      const langs = {};
      snippets.forEach(s => {
        const l = s.linguagem;
        if (!langs[l]) langs[l] = 0;
        langs[l]++;
      });
      return Object.entries(langs).sort((a, b) => b[1] - a[1]);
    }

    function getCategories(lang) {
      let filtered = snippets;
      if (lang) filtered = filtered.filter(s => s.linguagem === lang);
      const cats = {};
      filtered.forEach(s => {
        if (!cats[s.categoria]) cats[s.categoria] = 0;
        cats[s.categoria]++;
      });
      return Object.entries(cats).sort((a, b) => b[1] - a[1]);
    }

    function getFilteredSnippets() {
      let result = snippets;
      if (searchTerm) result = buscarSnippets(searchTerm);
      if (selectedLang) result = result.filter(s => s.linguagem === selectedLang);
      if (selectedCat) result = result.filter(s => s.categoria === selectedCat);
      return result;
    }

    function renderLanguages() {
      const langListEl = document.getElementById("langList");
      const langs = getLanguages();

      // All option
      let html = `<div class="lang-item ${!selectedLang ? 'active' : ''}" data-lang="" style="padding: 10px 18px; display: flex; align-items: center; gap: 10px; font-size: 14px;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(226,232,240,0.5)" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        <span style="color: ${!selectedLang ? 'var(--text-color)' : 'rgba(226,232,240,0.5)'};">Todas</span>
        <span style="margin-left: auto; font-size: 11px; background: rgba(99,102,241,0.1); padding: 1px 8px; border-radius: 10px; color: rgba(226,232,240,0.4);">${snippets.length}</span>
      </div>`;

      langs.forEach(([lang, count]) => {
        const isActive = selectedLang === lang;
        html += `<div class="lang-item ${isActive ? 'active' : ''}" data-lang="${escapeHtml(lang)}" style="padding: 10px 18px; display: flex; align-items: center; gap: 10px; font-size: 14px;">
          ${getLangIcon(lang)}
          <span style="color: ${isActive ? 'var(--text-color)' : 'rgba(226,232,240,0.5)'}; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(lang)}</span>
          <span style="margin-left: auto; font-size: 11px; background: rgba(99,102,241,0.1); padding: 1px 8px; border-radius: 10px; color: rgba(226,232,240,0.4);">${count}</span>
        </div>`;
      });

      langListEl.innerHTML = html;

      // Attach click events
      langListEl.querySelectorAll('.lang-item').forEach(el => {
        el.addEventListener('click', () => {
          const lang = el.getAttribute('data-lang');
          selectedLang = lang || null;
          selectedCat = null;
          renderAll();
        });
      });
    }

    function renderCategories() {
      const catListEl = document.getElementById("catList");
      const cats = getCategories(selectedLang);

      if (cats.length === 0) {
        catListEl.innerHTML = '<span style="font-size: 13px; color: rgba(226,232,240,0.2);">Nenhuma categoria</span>';
        return;
      }

      let html = `<div class="cat-chip ${!selectedCat ? 'active' : ''}" data-cat="" style="padding: 5px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; border: 1px solid rgba(99,102,241,0.2); background: ${!selectedCat ? 'var(--primary-color)' : 'transparent'}; color: ${!selectedCat ? 'white' : 'rgba(226,232,240,0.5)'};">Todas</div>`;

      cats.forEach(([cat, count]) => {
        const isActive = selectedCat === cat;
        html += `<div class="cat-chip ${isActive ? 'active' : ''}" data-cat="${escapeHtml(cat)}" style="padding: 5px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; border: 1px solid rgba(99,102,241,0.2); background: ${isActive ? 'var(--primary-color)' : 'transparent'}; color: ${isActive ? 'white' : 'rgba(226,232,240,0.5)'};">
          ${escapeHtml(cat)} <span style="opacity: 0.6;">(${count})</span>
        </div>`;
      });

      catListEl.innerHTML = html;

      catListEl.querySelectorAll('.cat-chip').forEach(el => {
        el.addEventListener('click', () => {
          const cat = el.getAttribute('data-cat');
          selectedCat = cat || null;
          renderSnippets();
          renderCategories();
        });
      });
    }

    function renderSnippets() {
      const snippetListEl = document.getElementById("snippetList");
      const emptyEl = document.getElementById("emptyState");
      const filtered = getFilteredSnippets();

      if (filtered.length === 0) {
        emptyEl.style.display = "block";
        snippetListEl.innerHTML = "";
        return;
      }

      emptyEl.style.display = "none";

      const existingCards = new Map(
        [...snippetListEl.children].map(el => [el.dataset.snippetId, el])
      );

      const newIds = new Set(filtered.map(s => String(s.id)));

      // Remove cards that no longer exist
      existingCards.forEach((el, id) => {
        if (!newIds.has(id)) el.remove();
      });

      filtered.forEach((s, index) => {
        const sid = String(s.id);
        if (existingCards.has(sid)) {
          // Update existing card
          const el = existingCards.get(sid);
          el.querySelector('.snippet-title').textContent = s.titulo;
          el.querySelector('.snippet-meta').innerHTML = `${getLangIcon(s.linguagem)} <span>${escapeHtml(s.linguagem)}</span> <span style="opacity:0.3;">‚Ä¢</span> <span>${escapeHtml(s.categoria)}</span>`;
          el.querySelector('.snippet-preview').textContent = s.codigo.substring(0, 120) + (s.codigo.length > 120 ? '...' : '');
        } else {
          // Create new card
          const card = document.createElement('div');
          card.className = 'snippet-card animate-fade-up';
          card.style.animationDelay = `${index * 0.05}s`;
          card.dataset.snippetId = sid;
          card.innerHTML = `
            <div style="padding: 16px;">
              <h3 class="snippet-title" style="font-size: 15px; font-weight: 600; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(s.titulo)}</h3>
              <div class="snippet-meta" style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: rgba(226,232,240,0.4); margin-bottom: 12px;">
                ${getLangIcon(s.linguagem)} <span>${escapeHtml(s.linguagem)}</span> <span style="opacity:0.3;">‚Ä¢</span> <span>${escapeHtml(s.categoria)}</span>
              </div>
              <div class="code-block" style="margin-bottom: 0;">
                <pre class="snippet-preview font-mono" style="padding: 12px; font-size: 11px; max-height: 80px; overflow: hidden; color: rgba(201,209,217,0.7);">${escapeHtml(s.codigo.substring(0, 120))}${s.codigo.length > 120 ? '...' : ''}</pre>
              </div>
            </div>
          `;
          card.addEventListener('click', () => openViewModal(s.id));
          snippetListEl.appendChild(card);
        }
      });
    }

    function renderCounts() {
      const totalEl = document.getElementById("totalCount");
      const langEl = document.getElementById("langCount");
      const totalNum = snippets.length;
      const langNum = getLanguages().length;
      totalEl.innerHTML = `<span style="color: #6366f1; font-weight: 700;">${totalNum}</span> snippet${totalNum !== 1 ? 's' : ''} salvo${totalNum !== 1 ? 's' : ''}`;
      langEl.innerHTML = `<span style="color: #22d3ee; font-weight: 700;">${langNum}</span> linguagen${langNum !== 1 ? 's' : ''}`;
    }

    function renderAll() {
      renderLanguages();
      renderCategories();
      renderSnippets();
      renderCounts();
    }

    // ===== Modals =====
    function openAddModal() {
      document.getElementById("addModal").style.display = "flex";
      document.getElementById("inputTitulo").focus();
    }

    function closeAddModal() {
      document.getElementById("addModal").style.display = "none";
      document.getElementById("addForm").reset();
    }

    function openViewModal(id) {
      const s = snippets.find(sn => sn.id === id);
      if (!s) return;

      const viewContent = document.getElementById("viewContent");
      viewContent.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
          <div>
            <h2 style="font-size: 22px; font-weight: 700; margin-bottom: 8px;">${escapeHtml(s.titulo)}</h2>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span class="tag-pill" style="background: rgba(34,211,238,0.12); color: #22d3ee;">${escapeHtml(s.linguagem)}</span>
              <span class="tag-pill">${escapeHtml(s.categoria)}</span>
            </div>
          </div>
          <button onclick="closeViewModal()" style="background: none; border: none; color: rgba(226,232,240,0.4); cursor: pointer; font-size: 24px; line-height: 1;" aria-label="Fechar">&times;</button>
        </div>
        <div class="code-block">
          <div class="code-header">
            <span style="font-size: 12px; color: rgba(226,232,240,0.4); font-family: 'JetBrains Mono', monospace;">${escapeHtml(s.linguagem)}</span>
            <button class="copy-btn" onclick="copyCode(${s.id})">
              <span style="display: flex; align-items: center; gap: 4px;">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copiar
              </span>
            </button>
          </div>
          <pre class="font-mono" style="white-space: pre-wrap; word-break: break-all;">${escapeHtml(s.codigo)}</pre>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;" id="viewActions">
          <button class="btn-danger" onclick="confirmDelete(${s.id})">
            <span style="display: flex; align-items: center; gap: 4px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
              Excluir
            </span>
          </button>
        </div>
      `;

      document.getElementById("viewModal").style.display = "flex";
    }

    function closeViewModal() {
      document.getElementById("viewModal").style.display = "none";
    }

    function confirmDelete(id) {
      const actionsEl = document.getElementById("viewActions");
      actionsEl.innerHTML = `
        <div class="confirm-inline">
          <span style="font-size: 13px; color: #f87171;">Tem certeza?</span>
          <button class="btn-danger" onclick="doDelete(${id})" style="font-size: 12px; padding: 6px 12px;">Sim, excluir</button>
          <button class="btn-ghost" onclick="openViewModal(${id})" style="font-size: 12px; padding: 6px 12px;">Cancelar</button>
        </div>
      `;
    }

    function doDelete(id) {
      removerSnippet(id);
      closeViewModal();
      renderAll();
      showToast("Snippet exclu√≠do!");
    }

    function copyCode(id) {
      const s = snippets.find(sn => sn.id === id);
      if (!s) return;
      navigator.clipboard.writeText(s.codigo).then(() => {
        showToast("C√≥digo copiado! üìã");
      }).catch(() => {
        showToast("N√£o foi poss√≠vel copiar");
      });
    }

    // ===== Toast =====
    function showToast(message) {
      const container = document.getElementById("toastContainer");
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.innerHTML = `<span style="display: flex; align-items: center; gap: 8px;">${message}</span>`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = "0";
        toast.style.transition = "opacity 0.3s ease";
        setTimeout(() => toast.remove(), 300);
      }, 2500);
    }

    // ===== Utilities =====
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // ===== Event Listeners =====
    document.getElementById("fabAdd").addEventListener("click", openAddModal);

    document.getElementById("addForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const titulo = document.getElementById("inputTitulo").value.trim();
      const linguagem = document.getElementById("inputLinguagem").value.trim();
      const categoria = document.getElementById("inputCategoria").value.trim();
      const codigo = document.getElementById("inputCodigo").value.trim();

      if (!titulo || !linguagem || !categoria || !codigo) return;

      adicionarSnippet(titulo, linguagem, categoria, codigo);
      closeAddModal();
      renderAll();
      showToast("Snippet salvo com sucesso! ‚ú®");
    });

    document.getElementById("searchInput").addEventListener("input", (e) => {
      searchTerm = e.target.value;
      renderSnippets();
    });

    // Close modals on overlay click
    document.getElementById("addModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeAddModal();
    });
    document.getElementById("viewModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeViewModal();
    });

    // Keyboard: Escape to close modals
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeAddModal();
        closeViewModal();
      }
    });

    // ===== Element SDK =====
    const defaultConfig = {
      app_title: "OrganizaCode",
      hero_title: "Feito para salvar seu tempo.",
      hero_subtitle: "S√≥ copie, cole e pronto! Organize seus trechos de c√≥digo por linguagem e categoria.",
      footer_text: "Desenvolvido por Amanda Reis",
      background_color: "#0a0e1a",
      surface_color: "#131829",
      text_color: "#e2e8f0",
      primary_color: "#6366f1",
      secondary_color: "#22d3ee",
      font_family: "Outfit",
      font_size: 16,
    };

    function applyConfig(config) {
      const bg = config.background_color || defaultConfig.background_color;
      const surface = config.surface_color || defaultConfig.surface_color;
      const text = config.text_color || defaultConfig.text_color;
      const primary = config.primary_color || defaultConfig.primary_color;
      const secondary = config.secondary_color || defaultConfig.secondary_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;

      document.documentElement.style.setProperty('--bg-color', bg);
      document.documentElement.style.setProperty('--surface-color', surface);
      document.documentElement.style.setProperty('--text-color', text);
      document.documentElement.style.setProperty('--primary-color', primary);
      document.documentElement.style.setProperty('--secondary-color', secondary);

      // Background & text
      document.body.style.background = bg;
      document.body.style.color = text;
      document.getElementById("appWrapper").style.background = bg;

      // App title
      const titleEl = document.getElementById("appTitle");
      titleEl.textContent = config.app_title || defaultConfig.app_title;
      titleEl.style.backgroundImage = `linear-gradient(135deg, ${primary}, ${secondary})`;

      // Hero
      const heroTitleEl = document.getElementById("heroTitle");
      const heroText = config.hero_title || defaultConfig.hero_title;
      heroTitleEl.innerHTML = heroText.replace(/tempo\.?$/, `<span style="background: linear-gradient(135deg, ${primary}, ${secondary}); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">tempo.</span>`);

      const heroSubEl = document.getElementById("heroSubtitle");
      heroSubEl.textContent = config.hero_subtitle || defaultConfig.hero_subtitle;

      // Footer
      const footerEl = document.getElementById("footerText");
      const footerText = config.footer_text || defaultConfig.footer_text;
      if (footerText.includes("Amanda Reis")) {
        footerEl.innerHTML = footerText.replace("Amanda Reis", `<span style="color: ${primary}; font-weight: 600;">Amanda Reis</span>`);
      } else {
        footerEl.innerHTML = `<span style="color: ${primary}; font-weight: 600;">${escapeHtml(footerText)}</span>`;
      }

      // FAB
      const fabEl = document.getElementById("fabAdd");
      fabEl.style.background = primary;
      fabEl.style.boxShadow = `0 4px 20px ${primary}66`;

      // Font
      const baseFontStack = 'Arial, sans-serif';
      document.body.style.fontFamily = `${fontFamily}, ${baseFontStack}`;

      // Font size scaling
      heroTitleEl.style.fontSize = `${fontSize * 2.5}px`;
      heroSubEl.style.fontSize = `${fontSize}px`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          applyConfig(config);
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (v) => { config.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (v) => { config.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (v) => { config.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (v) => { config.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (v) => { config.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (v) => { config.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (v) => { config.font_size = v; window.elementSdk.setConfig({ font_size: v }); }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["hero_title", config.hero_title || defaultConfig.hero_title],
          ["hero_subtitle", config.hero_subtitle || defaultConfig.hero_subtitle],
          ["footer_text", config.footer_text || defaultConfig.footer_text],
        ])
      });
    }

    // Initial render
    renderAll();
    applyConfig(defaultConfig);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ccdddd804946d60',t:'MTc3MDkxNzk3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>